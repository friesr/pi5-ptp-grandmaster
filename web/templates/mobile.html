<!DOCTYPE html>
<html>
<head>
    <title>Mobile Dashboard</title>
    <link rel="stylesheet" href="/static/css/mobile.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<header>Mobile Dashboard</header>

<div class="card">
    <h2><img class="icon" src="/static/icons/health.svg"> System Health</h2>
    <div id="sys"></div>
</div>

<div class="card">
    <h2><img class="icon" src="/static/icons/gnss.svg"> GNSS Status</h2>
    <div id="gnss"></div>
</div>

<div class="card">
    <h2><img class="icon" src="/static/icons/ptp.svg"> PTP Timing</h2>
    <div id="ptp"></div>
</div>

<div class="card">
    <h2><img class="icon" src="/static/icons/confidence.svg"> Timing Confidence</h2>
    <div id="confidence"></div>
</div>

<div class="card">
    <h2><img class="icon" src="/static/icons/interference.svg"> Interference</h2>
    <div id="interference"></div>
</div>

<div class="card">
    <h2><img class="icon" src="/static/icons/sla.svg"> SLA Violations</h2>
    <div id="sla"></div>
</div>

<div class="card">
    <h2 onclick="toggleTools()" style="cursor:pointer;">More Tools â–¼</h2>
    <div id="more-tools" style="display:none;">
        <button class="nav-button" onclick="location.href='/preferences'">Preferences</button>
        <button class="nav-button" onclick="location.href='/mobile-mission'">Mission Control</button>
        <button class="nav-button" onclick="location.href='/mobile-alerts'">Alerts</button>
    </div>
</div>

<div class="bottom-nav">
    <button class="nav-button" onclick="location.href='/mobile'">Dashboard</button>
    <button class="nav-button" onclick="location.href='/mobile-mission'">Mission</button>
    <button class="nav-button" onclick="location.href='/mobile-alerts'">Alerts</button>
    <button class="nav-button" onclick="location.href='/preferences'">Prefs</button>
</div>
<script src="/static/js/mobile_viz.js"></script>
<script>
function fetchSnapshot() {
    fetch('/api/mobile_snapshot')
        .then(r => r.json())
        .then(d => {
            document.getElementById('sys').innerText =
                `CPU: ${d.system.cpu}% | RAM: ${d.system.memory}% | Disk: ${d.system.disk}%`;

            document.getElementById('gnss').innerText =
                `Locked: ${d.gnss.locked} | Visible: ${d.gnss.visible}`;

            document.getElementById('ptp').innerText =
                `Offset: ${d.ptp.offset} ns | Jitter: ${d.ptp.jitter}`;

            document.getElementById('confidence').innerText =
                `Score: ${d.confidence.score}`;

            document.getElementById('interference').innerText =
                `Level: ${d.interference.level}`;

            document.getElementById('sla').innerText =
                `Today: ${d.sla.count}`;
        });
}

function toggleTools() {
    const t = document.getElementById('more-tools');
    t.style.display = t.style.display === "none" ? "block" : "none";
}

setInterval(fetchSnapshot, 10000);
fetchSnapshot();
</script>

</body>
</html>
